(function(e){function t(t){for(var i,o,s=t[0],c=t[1],l=t[2],h=0,d=[];h<s.length;h++)o=s[h],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&d.push(r[o][0]),r[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);u&&u(t);while(d.length)d.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,s=1;s<n.length;s++){var c=n[s];0!==r[c]&&(i=!1)}i&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},r={app:0},a=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var u=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"034f":function(e,t,n){"use strict";var i=n("85ec"),r=n.n(i);r.a},1:function(e,t){},2:function(e,t){},"24b1":function(e,t,n){},3:function(e,t){},"85ec":function(e,t,n){},"9f15":function(e,t,n){},ae27:function(e,t,n){"use strict";var i=n("d19f"),r=n.n(i);r.a},c26c:function(e,t,n){"use strict";var i=n("9f15"),r=n.n(i);r.a},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("Home",{attrs:{msg:"Welcome to Your Vue.js + TypeScript App"}})],1)},a=[],o=n("9f12"),s=n("8b83"),c=n("c65a"),l=n("c03e"),u=n("9ab4"),h=n("60a3"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"home"}},[n("Stage",{attrs:{id:"stage",size:e.stageSize}}),n("FacialExpression",{attrs:{id:"facial",size:{width:640,height:480}}})],1)},f=[],m=n("53fe"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"stage"}})},v=[],b=(n("d3b7"),n("3ca3"),n("ddb0"),n("f7e7")),g=n("5a89"),y=n("34ad"),w=function(e){function t(){var e;return Object(o["a"])(this,t),e=Object(s["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.scene=new g["Scene"],e.renderer=new g["WebGLRenderer"]({alpha:!0}),e.camera=null,e.light=new g["DirectionalLight"](16777215),e.loader=new y["a"],e.vrm1=null,e.vrm2=null,e.mixer1=null,e.mixer2=null,e.clock=new g["Clock"],e}return Object(l["a"])(t,e),Object(m["a"])(t,[{key:"created",value:function(){console.log("created",this),console.log("store",this.$store),console.log("facialExpression",this.$store.getters.facialExpression)}},{key:"mounted",value:function(){var e=this;this.renderer.setSize(this.size.width,this.size.height),this.renderer.setClearColor(0,0),this.camera=new g["PerspectiveCamera"](20,this.size.width/this.size.height,.1,1e3),this.camera.position.set(0,1.2,3),this.light.position.set(1,1,1).normalize(),this.scene.add(this.light);var t=.45,n=new Promise((function(n,i){e.loaderLoad("/models/cecil-pink.vrm",-1*t,0,0).then((function(t){console.log("vrm1",t),e.vrm1=t.vrm,e.mixer1=t.mixer,n(!0)}))})),i=new Promise((function(n,i){e.loaderLoad("/models/cecil-blue.vrm",t,0,0).then((function(t){console.log("vrm２",t),e.vrm2=t.vrm,e.mixer2=t.mixer,n(!0)}))}));Promise.all([n,i]).then((function(t){console.log("values",t),console.log("vrm1",e.vrm1,e.mixer1),console.log("vrm2",e.vrm2,e.mixer2),e.animate()}));var r=document.getElementById("stage");null!==r&&(r.style.width=this.size.width,r.style.height=this.size.height,r.appendChild(this.renderer.domElement))}},{key:"loaderLoad",value:function(e,t,n,i){var r=this;return new Promise((function(a,o){r.loader.load(e,(function(e){b["VRM"].from(e).then((function(e){var o=e;fetch("/poses/pose.json").then((function(e){return e.json()})).then((function(e){o.humanoid.setPose(e),r.scene.add(o.scene),o.scene.position.set(t,n,i);var s=new g["AnimationMixer"](o.scene);a({vrm:o,mixer:s})}))}))}),(function(e){console.log("Loading model...",e.loaded/e.total*100,"%")}),(function(e){console.error(e)}))}))}},{key:"prepareAnimation",value:function(e,t){var n=e.blendShapeProxy.getBlendShapeTrackName(b["VRMSchema"].BlendShapePresetName.Blink),i=new g["NumberKeyframeTrack"](n,[0,.5,1],[0,1,0]),r=new g["AnimationClip"]("blink",1,[i]),a=t.clipAction(r);a.play()}},{key:"animate",value:function(){requestAnimationFrame(this.animate);var e=this.clock.getDelta();if(null!==this.vrm1&&null!==this.mixer1){this.vrm1.update(e),this.mixer1.update(e);var t=this.$store.getters.facialExpression;if(this.vrm1.blendShapeProxy){var n=.9<t.eyelid.blink_l?0:t.eyelid.blink_l,i=.9<t.eyelid.blink_r?0:t.eyelid.blink_r;this.vrm1.blendShapeProxy.setValue(b["VRMSchema"].BlendShapePresetName.A,t.mouth.a),this.vrm1.blendShapeProxy.setValue(b["VRMSchema"].BlendShapePresetName.BlinkL,n),this.vrm1.blendShapeProxy.setValue(b["VRMSchema"].BlendShapePresetName.BlinkR,i)}}if(null!==this.vrm2&&null!==this.mixer2){this.vrm2.update(e),this.mixer2.update(e);var r=this.$store.getters.facialExpression;if(this.vrm2.blendShapeProxy){var a=.9<r.eyelid.blink_l?0:r.eyelid.blink_l,o=.9<r.eyelid.blink_r?0:r.eyelid.blink_r;this.vrm2.blendShapeProxy.setValue(b["VRMSchema"].BlendShapePresetName.A,r.mouth.a),this.vrm2.blendShapeProxy.setValue(b["VRMSchema"].BlendShapePresetName.BlinkL,a),this.vrm2.blendShapeProxy.setValue(b["VRMSchema"].BlendShapePresetName.BlinkR,o)}}this.renderer.render(this.scene,this.camera)}}]),t}(h["c"]);u["c"]([Object(h["b"])()],w.prototype,"size",void 0),w=u["c"]([h["a"]],w);var k=w,x=k,O=(n("ae27"),n("2877")),j=Object(O["a"])(x,p,v,!1,null,"7c197518",null),E=j.exports,_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"facial-expression"},[n("button",{on:{click:e.clickCameraOn}},[e._v("カメラON")]),e._m(0)])},S=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"facial-container"}},[n("video",{attrs:{id:"facial-camera",playsinline:"",autoplay:""}}),n("canvas",{attrs:{id:"facial-overlay"}})])}],L=(n("96cf"),n("ab39")),P=function(e){function t(){var e;return Object(o["a"])(this,t),e=Object(s["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.MODEL_URI="/face/weights",e}return Object(l["a"])(t,e),Object(m["a"])(t,[{key:"created",value:function(){console.log("created",this.size),console.log("store",this.$store),console.log("facialExpression",this.$store.getters.facialExpression)}},{key:"mounted",value:function(){var e=document.getElementById("facial-container");if(e instanceof HTMLElement){var t=document.getElementById("facial-camera");if(t instanceof HTMLVideoElement){this.camera=t;var n=document.getElementById("facial-overlay");n instanceof HTMLCanvasElement?(this.overlay=n,e.style.width="".concat(this.size.width,"px"),e.style.height="".concat(this.size.height,"px"),this.camera.width=this.size.width,this.camera.height=this.size.height,this.overlay.width=this.size.width,this.overlay.height=this.size.height,Promise.all([L["d"].tinyFaceDetector.loadFromUri(this.MODEL_URI),L["d"].faceLandmark68Net.loadFromUri(this.MODEL_URI),L["d"].faceExpressionNet.loadFromUri(this.MODEL_URI)]).then((function(){console.log("load MODEL_URI")}))):console.error("overlayEle not an HTMLCanvasElement")}else console.error("cameraEle not an HTMLVideoElement")}else console.error("containerEle not an HTMLElement",e)}},{key:"clickCameraOn",value:function(){var e=this;console.log("clickCameraOn",this.camera.srcObject),this.camera.srcObject?console.log("stop"):navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((function(t){null!==e.camera&&(e.camera.srcObject=t,e.drawLoop())}))}},{key:"landmarkOpenLv",value:function(e,t,n,i){var r=e[t].y,a=e[n].y,o=Math.abs(r-a)/i;return o>1?1:o}},{key:"drawLoop",value:function(){var e,t,n,i;return regeneratorRuntime.async((function(r){while(1)switch(r.prev=r.next){case 0:if(requestAnimationFrame(this.drawLoop),null===this.overlay||null===this.camera){r.next=18;break}return r.next=4,regeneratorRuntime.awrap(L["b"](this.camera,new L["a"]).withFaceLandmarks().withFaceExpressions());case 4:if(e=r.sent,"undefined"!==typeof e){r.next=7;break}return r.abrupt("return");case 7:t=e.landmarks,n=this.$store.getters.facialExpression,n.eyelid.blink_l=this.landmarkOpenLv(t.getLeftEye(),1,4,10),n.eyelid.blink_r=this.landmarkOpenLv(t.getRightEye(),2,5,10),n.mouth.a=this.landmarkOpenLv(t.getMouth(),15,19,25),this.$store.dispatch("doUpdateFacialExpression",n),i=L["e"](e,{width:this.size.width,height:this.size.height}),this.overlay.getContext("2d").clearRect(0,0,this.size.width,this.size.height),L["c"].drawDetections(this.overlay,i),L["c"].drawFaceLandmarks(this.overlay,i),L["c"].drawFaceExpressions(this.overlay,i);case 18:case"end":return r.stop()}}),null,this)}}]),t}(h["c"]);u["c"]([Object(h["b"])()],P.prototype,"size",void 0),P=u["c"]([h["a"]],P);var M=P,z=M,R=(n("e3b0"),Object(O["a"])(z,_,S,!1,null,"91dc579e",null)),V=R.exports,B=function(e){function t(){var e;return Object(o["a"])(this,t),e=Object(s["a"])(this,Object(c["a"])(t).apply(this,arguments)),e.stageSize={width:window.innerWidth,height:window.innerHeight},e}return Object(l["a"])(t,e),Object(m["a"])(t,[{key:"created",value:function(){console.log("created")}}]),t}(h["c"]);B=u["c"]([Object(h["a"])({components:{Stage:E,FacialExpression:V}})],B);var F=B,N=F,C=(n("c26c"),Object(O["a"])(N,d,f,!1,null,"1626607c",null)),$=C.exports,A=function(e){function t(){return Object(o["a"])(this,t),Object(s["a"])(this,Object(c["a"])(t).apply(this,arguments))}return Object(l["a"])(t,e),t}(h["c"]);A=u["c"]([Object(h["a"])({components:{Home:$}})],A);var T=A,U=T,D=(n("034f"),Object(O["a"])(U,r,a,!1,null,null,null)),H=D.exports,I=n("9483");Object(I["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var q=n("2f62"),W=function(){function e(t){Object(o["a"])(this,e),this._values={index:0,mouth:{a:0,i:0,u:0,e:0,o:0},eyelid:{blink_l:0,blink_r:0,blink:0},look:{lookdown:0,lookup:0,lookleft:0,lookright:0},emotion:{angry:0,fun:0,joy:0,neutral:0,sorrow:0,unknown:0}},this._values.index=t}return Object(m["a"])(e,[{key:"setValues",value:function(e){this._values=e}},{key:"values",get:function(){return this._values}}]),e}();i["a"].use(q["a"]);var J=new q["a"].Store({state:{facialExpression:new W(0)},mutations:{setFacialExpression:function(e,t){e.facialExpression.setValues(t.src)}},actions:{doUpdateFacialExpression:function(e,t){var n=e.commit;n("setFacialExpression",{src:t})}},getters:{facialExpression:function(e){return e.facialExpression.values}},modules:{}});i["a"].config.productionTip=!1,new i["a"]({store:J,render:function(e){return e(H)}}).$mount("#app")},d19f:function(e,t,n){},e3b0:function(e,t,n){"use strict";var i=n("24b1"),r=n.n(i);r.a}});
//# sourceMappingURL=app.94fa06ce.js.map